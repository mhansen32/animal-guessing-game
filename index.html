<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Animal Guessing Game</title>
  <style>
    button {
      transition: background-color 0.3s ease, transform 0.2s ease;
    }
    button:hover {
      transform: scale(1.03);
      filter: brightness(1.1);
    }
    #result {
      transition: opacity 0.4s ease-in-out;
      opacity: 0;
      animation: fadeIn 0.6s ease forwards;
    }
    #animal-image img {
      animation: fadeIn 0.8s ease forwards;
    }
    body {
      font-family: Arial, sans-serif;
      background-color: #eaf4fb;
      margin: 2rem;
    }
    #progress-container {
      width: 100%;
      height: 10px;
      background: #ddd;
      margin-top: 1rem;
      border-radius: 5px;
      overflow: hidden;
    }
    #progress-bar {
      width: 100%;
      height: 100%;
      background: #4caf50;
      transition: width 0.5s linear, background-color 0.3s ease;
    }
    @keyframes pulseReset {
      0% { transform: scaleX(1); background-color: #2196f3; }
      50% { transform: scaleX(1.05); background-color: #64b5f6; }
      100% { transform: scaleX(1); background-color: #4caf50; }
    }
    @keyframes fadeIn {
      to { opacity: 1; }
    }
    .confetti-piece {
      position: absolute;
      width: 10px;
      height: 10px;
      background-color: red;
      animation: confetti 2s ease-out forwards;
      border-radius: 2px;
    }
    @keyframes confetti {
      0% { transform: translateY(0); opacity: 1; }
      100% { transform: translateY(300px); opacity: 0; }
    }
      @media screen and (max-width: 600px) {
      body {
        margin: 1rem;
      }
      input[type='text'] {
        width: 100%;
        margin-bottom: 0.5rem;
        font-size: 1rem;
      }
      button {
        width: 100%;
        margin-bottom: 1rem;
        font-size: 1rem;
      }
      select {
        margin-bottom: 1rem;
        font-size: 1rem;
        width: 100%;
      }
      #mute-toggle {
        top: 0.5rem;
        right: 0.5rem;
      }
    }
  </style>
  <audio id="correctSound" src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg" preload="auto"></audio>
  <audio id="wrongSound" src="https://actions.google.com/sounds/v1/cartoon/cartoon_boing.ogg" preload="auto"></audio>
  <audio id="bgm" src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" preload="auto" loop autoplay></audio>
  <audio id="confettiSound" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg" preload="auto"></audio>
</head>
<body>
  <div style="max-width: 700px; margin: auto; text-align: center;">
    <h1 style="font-size: 2.2rem; color: #1c4966;">üêæ Animal Guessing Game</h1>
    <p style="font-size: 1.1rem; color: #333;">Select your filters and see if you can guess the animal in <strong>5 tries or less!</strong></p>

    <div style="margin-bottom: 1rem;">
      <label for="difficulty">Difficulty:</label>
      <select id="difficulty">
        <option value="easy">Easy</option>
        <option value="medium">Medium</option>
        <option value="hard">Hard</option>
      </select>

      <label for="habitat" style="margin-left: 1rem;">Habitat:</label>
      <select id="habitat">
        <option value="forest">Forest</option>
        <option value="jungle">Jungle</option>
        <option value="desert">Desert</option>
        <option value="plains">Plains</option>
        <option value="mountain">Mountain</option>
        <option value="ocean">Ocean</option>
        <option value="river">River</option>
        <option value="tundra">Tundra</option>
        <option value="home">Home</option>
        <option value="farm">Farm</option>
      </select>

      <label for="size" style="margin-left: 1rem;">Size:</label>
      <select id="size">
        <option value="small">Small</option>
        <option value="medium">Medium</option>
        <option value="large">Large</option>
      </select>
    </div>

    <button onclick="startGame()" style="padding: 0.6rem 1.2rem; font-size: 1rem; background-color: #2196f3; color: white; border: none; border-radius: 6px; cursor: pointer;">Start Game</button>

    <div id="game" style="display: none; margin-top: 2rem;">
      <button onclick="revealHint()" style="padding: 0.4rem 0.8rem; font-size: 0.9rem; background-color: #ff9800; color: white; border: none; border-radius: 4px; cursor: pointer;">üîç Give me a hint</button>
      <div id="clues" style="margin-bottom: 1rem;"></div>
      <input type="text" id="guess" placeholder="Your guess..." onkeydown="if(event.key === 'Enter') checkGuess();">
      <button onclick="checkGuess()" style="padding: 0.4rem 1rem; font-size: 1rem; background-color: #4caf50; color: white; border: none; border-radius: 4px; cursor: pointer;">Guess</button>

      <div id="progress-container">
        <div id="progress-bar"></div>
      </div>

      <div id="result" style="margin-top: 1rem; font-size: 1.1rem;"></div>
      <div id="animal-image" style="margin-top: 1rem;"></div>
    </div>

    <button id="play-again" onclick="startGame()" style="padding: 0.5rem 1rem; font-size: 1rem; background-color: #673ab7; color: white; border: none; border-radius: 6px; cursor: pointer; display: none; margin-top: 2rem;">Play Again</button>
    <div id="stats" style="margin-top: 2rem; font-weight: bold;"></div>
    <div id="scoreboard" style="margin-top: 2rem; font-size: 0.9rem; color: #444;"></div>
    <div id="confetti-container" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 999;"></div>
  </div>
<script>
// JavaScript logic for animal selection, gameplay, sound, confetti, progress bar, and scoreboard
// Global game state variables
const allAnimals = [];
fetch('animals.json')
  .then(response => response.json())
  .then(data => allAnimals.push(...data))
  .catch(err => console.error('Failed to load animals:', err));
let selectedAnimal = null;
let currentClueIndex = 0;
let guessCount = 0;
let bestScore = localStorage.getItem('bestScore') || Infinity;
let scoreHistory = JSON.parse(localStorage.getItem('scoreHistory') || '[]');

function startGame() {
  hintCount = 0;
  const difficulty = document.getElementById('difficulty').value;
  const habitat = document.getElementById('habitat').value;
  const size = document.getElementById('size').value;

  const filtered = allAnimals.filter(a => a.difficulty === difficulty && a.habitat === habitat && a.size === size);
  if (filtered.length === 0) {
    alert("No animals match that filter. Try different settings.");
    return;
  }

  selectedAnimal = filtered[Math.floor(Math.random() * filtered.length)];
  currentClueIndex = 0;
  guessCount = 0;

  document.getElementById('game').style.display = 'block';
  document.getElementById('clues').innerHTML = `<div style='animation: fadeIn 0.6s ease forwards;'>üîç ${selectedAnimal.clues[0]}</div>`;
  document.getElementById('result').textContent = '';
  document.getElementById('animal-image').innerHTML = '';
  document.getElementById('guess').value = '';
  document.getElementById('guess').focus();
  document.getElementById('play-again').style.display = 'none';
  startTimer();
}

function startTimer() {
  let timeLeft = 20;
  const progressBar = document.getElementById('progress-bar');
  progressBar.style.width = '100%';
  progressBar.style.animation = 'none';
  progressBar.offsetHeight;
  progressBar.style.animation = 'pulseReset 0.5s ease';

  if (window.progressInterval) clearInterval(window.progressInterval);
  window.progressInterval = setInterval(() => {
    timeLeft--;
    progressBar.style.width = (timeLeft * 5) + '%';
    if (timeLeft <= 0) {
      clearInterval(window.progressInterval);
      document.getElementById('result').textContent = `‚è∞ Time's up! The animal was ${selectedAnimal.name}.`;
      document.getElementById('game').style.display = 'none';
      document.getElementById('play-again').style.display = 'inline-block';
      document.getElementById('animal-image').innerHTML = `<img src='https://source.unsplash.com/400x300/?${encodeURIComponent(selectedAnimal.name)}' alt='${selectedAnimal.name}' style='max-width: 100%; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.2); margin-top: 1rem;'>`;
    }
  }, 1000);
}

let hintCount = 0;
const maxHints = 2;

function revealHint() {
  if (hintCount >= maxHints) {
    alert("üö´ No more hints available.");
    return;
  }
  if (selectedAnimal && currentClueIndex < selectedAnimal.clues.length - 1) {
    currentClueIndex++;
    hintCount++;
    document.getElementById('clues').innerHTML += `<div style='animation: fadeIn 0.6s ease forwards;'>üîç ${selectedAnimal.clues[currentClueIndex]}</div>`;
    startTimer();
  }
}</div>`;
    startTimer();
  }
}</div>`;
  }
}

function checkGuess() {
  const guess = document.getElementById('guess').value.toLowerCase().trim();
  if (!selectedAnimal || guess === '') return;

  guessCount++;
  if (guess === selectedAnimal.name.toLowerCase()) {
    document.getElementById('correctSound').play();
    clearInterval(window.progressInterval);
    document.getElementById('result').innerHTML = `üéâ Correct! The animal was <strong>${selectedAnimal.name}</strong>.<br><em>Fun fact: ${selectedAnimal.clues[selectedAnimal.clues.length - 1]}</em>`;
    document.getElementById('game').style.display = 'none';
    document.getElementById('play-again').style.display = 'inline-block';
    document.getElementById('animal-image').innerHTML = `<img src='https://source.unsplash.com/400x300/?${encodeURIComponent(selectedAnimal.name)}' alt='${selectedAnimal.name}' style='max-width: 100%; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.2); margin-top: 1rem;'>`;
    launchConfetti();
    document.getElementById('confettiSound').play();
    updateHighScore(20 - parseInt(document.getElementById('progress-bar').style.width) / 5, guessCount);
    logScore(20 - parseInt(document.getElementById('progress-bar').style.width) / 5, guessCount);
  } else {
    document.getElementById('wrongSound').play();
    if (guessCount >= 5) {
      clearInterval(window.progressInterval);
      document.getElementById('result').textContent = `‚ùå Out of guesses! The animal was ${selectedAnimal.name}.`;
      document.getElementById('game').style.display = 'none';
      document.getElementById('play-again').style.display = 'inline-block';
      document.getElementById('animal-image').innerHTML = `<img src='https://source.unsplash.com/400x300/?${encodeURIComponent(selectedAnimal.name)}' alt='${selectedAnimal.name}' style='max-width: 100%; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.2); margin-top: 1rem;'>`;
      return;
    }
    currentClueIndex++;
    if (currentClueIndex < selectedAnimal.clues.length) {
      document.getElementById('clues').innerHTML += `<div style='animation: fadeIn 0.6s ease forwards;'>üîç ${selectedAnimal.clues[currentClueIndex]}</div>`;
    }
    document.getElementById('guess').value = '';
    document.getElementById('guess').focus();
    startTimer();
  }
}

function updateHighScore(timeTaken, guessCount) {
  const score = timeTaken + guessCount * 5;
  if (score < bestScore) {
    bestScore = score;
    localStorage.setItem('bestScore', score);
    document.getElementById('stats').innerHTML = `üèÜ New High Score! Score: ${score}`;
  } else {
    document.getElementById('stats').innerHTML = `High Score to Beat: ${bestScore}`;
  }
}

function logScore(timeTaken, guessCount) {
  const score = timeTaken + guessCount * 5;
  const timestamp = new Date().toLocaleString();
  const entry = { animal: selectedAnimal.name, time: timeTaken, guesses: guessCount, score, timestamp };
  scoreHistory.unshift(entry);
  scoreHistory = scoreHistory.slice(0, 5);
  localStorage.setItem('scoreHistory', JSON.stringify(scoreHistory));
  renderScoreboard();
}

function renderScoreboard() {
  const sb = document.getElementById('scoreboard');
  if (!scoreHistory.length) return;
  sb.innerHTML = '<h3>üìä Scoreboard (last 5 games)</h3><ul>' + scoreHistory.map(e => `<li>${e.timestamp} ‚Äî üêæ ${e.animal}: ‚è± ${e.time}s | üß† ${e.guesses} guesses | üèÜ Score ${e.score}</li>`).join('') + '</ul>';
}

function launchConfetti() {
  const container = document.getElementById('confetti-container');
  for (let i = 0; i < 50; i++) {
    const confetti = document.createElement('div');
    confetti.className = 'confetti-piece';
    confetti.style.left = Math.random() * window.innerWidth + 'px';
    confetti.style.top = '-10px';
    confetti.style.backgroundColor = `hsl(${Math.random() * 360}, 70%, 60%)`;
    confetti.style.animationDelay = `${Math.random()}s`;
    confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
    container.appendChild(confetti);
    setTimeout(() => confetti.remove(), 2000);
  }
}
</script>
</script>
<button id="mute-toggle" onclick="toggleMute()" style="position: fixed; top: 1rem; right: 1rem; padding: 0.3rem 0.6rem;">üîä</button>
<script>
let isMuted = false;
function toggleMute() {
  isMuted = !isMuted;
  document.getElementById('bgm').muted = isMuted;
  document.getElementById('correctSound').muted = isMuted;
  document.getElementById('wrongSound').muted = isMuted;
  document.getElementById('confettiSound').muted = isMuted;
  document.getElementById('mute-toggle').textContent = isMuted ? 'üîá' : 'üîä';
}
</script>
<button onclick="cheatReveal()" style="position: fixed; bottom: 1rem; right: 1rem; padding: 0.4rem 0.6rem; font-size: 0.8rem; opacity: 0.4;">üß™ Cheat</button>
<script>
function cheatReveal() {
  if (!selectedAnimal) return;
  alert(`üß™ DEBUG: The answer is ${selectedAnimal.name}`);
}
</script>
</body>
</html>
